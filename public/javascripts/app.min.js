function BannerSlide(e,i,a){this.img=e,this.duration=a||2e3,this.fade=i}var app={state:"allow",form:{width:0,height:0,slides:[]},sendForm:function(){app.form.slides=[],app.form.id=$("#bannerId").val(),app.form.width=$("#bannerWidth").val(),app.form.height=$("#bannerHeight").val(),app.form.name=$("#bannerName").val(),$(".c-files__item").each(function(){var e=$($(this).find(".c-files__name")).val(),i=$($(this).find(".c-files__fade")).val(),a=$($(this).find(".c-files__duration")).val();app.form.slides.push(new BannerSlide(e,(+i),(+a)))}),$.ajax({method:"POST",data:JSON.stringify(app.form,"",4),dataType:"json",contentType:"application/json",url:"/updateForm"}).done(function(){window.location.reload()})}};$(function(){function e(e,i,a){var n=['<div class="c-files__item">','<div class="c-files__img" data-img="../banner/'+e+'" style="background-image: url(../banner/'+e+')"></div>','<input type="number" class="c-files__duration" min="0" step="100" value="'+i+'">','<input type="number" class="c-files__fade" min="0" step="100" value="'+a+'">','<input type="hidden" class="c-files__name" value="'+e+'">','<div class="c-files__remove"></div>','<div class="c-files__info"></div>',"</div>"];return n.join("")}$(".c-files").sortable({change:function(e,i){app.state="lock"}}),$(".c-files__remove").on("click",function(){var e=$(this).closest(".c-files__item");app.state="lock",e.fadeOut(400,function(){e.remove()})}),$(".j-upd").on("click",function(){app.sendForm()}),$('a[href="/download"]').on("click",function(e){var i=!0;"lock"===app.state&&(i=confirm("Есть несохраненные изменения,\nСкачать без сохранения?")),i||e.preventDefault()}),$(".c-files__duration, .c-files__fade").on("change",function(){app.state="lock"}),$(".c-files__img").each(function(){var e=$(this).closest(".c-files__item"),i=e.find(".c-files__info"),a=new Image;a.src=$(this).attr("data-img"),a.onload=function(){$(i).html(a.width+"X"+a.height),+$("#bannerWidth").val()===a.width&&+$("#bannerHeight").val()===a.height||$(e).addClass("c-files__item--error"),console.log(a.width,+$("#bannerWidth").val())}}),$("#addsFiles").change(function(){var i=new FormData;$.each($("#addsFiles")[0].files,function(e,a){var a=$("#addsFiles")[0].files[e];i.append("newslide",a)}),$.ajax({url:"/addslide",data:i,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(e){}}).done(function(i){i.forEach(function(i,a){var n=e(i.img,i.duration,i.fade);$(".c-files").append(n)}),app.sendForm()})})});